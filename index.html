<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="title">CHAT - å³æ™‚çš„èŠå¤©ç³»çµ±</title>
  <link rel="shortcut icon" href="/icon/favicon.ico" />
  <!--BS CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
  <!--BS icon-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.9.1/font/bootstrap-icons.css"
    integrity="sha512-CaTMQoJ49k4vw9XO0VpTBpmMz8XpCWP5JhGmBvuBqCOaOHWENWO1CrVl09u4yp8yBVSID6smD4+gpzDJVQOPwQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    body {
      margin: 8px;
      padding-bottom: 3rem;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    }

    nav {
      position: sticky;
      width: 100%;
      top: 0;
    }

    .bottom {
      position: fixed;
      bottom: 0;

    }

    .bottom-bar {
      background: rgba(0, 0, 0, 0.15);
      padding: 0.25rem;

      display: flex;
      height: 3rem;
      box-sizing: border-box;
      backdrop-filter: blur(10px);
    }

    .input {
      border: none;
      padding: 0 1rem;
      flex-grow: 1;
      border-radius: 2rem;
      margin: 0.25rem;
    }

    .input:focus {
      outline: none;
    }

    .msg-form {

      display: flex;
    }

    .messages,
    ul {
      list-style-type: none;
      margin: 0;
      padding: 0;
    }

    .messages>li {
      padding: 0.5rem 1rem;
      border-bottom: 1px #333 solid;
    }


    .statue-bar {
      position: sticky;
      top: 0px;
      background-color: #fff;


    }

    .flex {
      display: flex;
    }

    .warn {
      background-color: #f4a3ab !important;
    }

    .success {
      background-color: #98f9b1 !important;
    }

    .info {
      background-color: #94e3ff !important;
    }


    table,
    td {
      border: 1px solid #333;
    }

    thead,
    tfoot {
      background-color: #333;
      color: #fff;
    }

    .btn-file {
      position: relative;
      overflow: hidden;
    }

    .btn-file input[type=file] {
      position: absolute;
      top: 0;
      right: 0;
      min-width: 100%;
      min-height: 100%;
      font-size: 100px;
      text-align: right;
      filter: alpha(opacity=0);
      opacity: 0;
      outline: none;
      background: white;
      cursor: inherit;
      display: block;
    }


    .text {
      border: 1px #333 solid;
      border-radius: 5px;
      max-height: 50vh;
      /*   max-width: 30vw;*/
    }

    .badge>h6 {
      margin: 0;
    }

    .radio input[type="radio"] {
      display: none;
    }

    .checkbox input[type="checkbox"] {
      display: none;
    }

    .radio input:checked+.button {
      background: #3296d4;
      color: #fff;
      cursor: default;
    }

    .checkbox input:checked+.button {
      background: #3296d4;
      color: #fff;
      cursor: pointer;

    }

    .radio .button,
    .checkbox .button {
      display: inline-block;


      margin: 0 0.5vw 0.5vw 0;
      padding: 0.25vw 0.5vw;
      background: #f7f7f7;
      color: #333;
      cursor: pointer;
      border: 1px solid #8b8b8b;
      transition: background-color 0.3s, color 0.3s;
    }

    .radio .button:hover,
    .checkbox .button:hover {
      background-color: #bbb;
      color: #fff;
    }

    .radio .round,
    .checkbox .round {
      border-radius: 5px;
    }

    .tab-content {
      flex-grow: 1;
      padding-top: 5px;
    }

    #v-pills-tab {
      position: sticky !important;
      padding-top: 5px;

      overflow-x: hidden;
      flex-wrap: nowrap;


      overflow-y: scroll !important;
      max-height: 80vh;

    }

    #v-pills-tab .nav-link {
      white-space: nowrap;
    }

    #toast {
      z-index: 20000 !important;
    }
  </style>

  <script>
    var
      NowDate = new Date(),
      sec = NowDate.getSeconds(),
      mins = NowDate.getMinutes(),
      hour = NowDate.getHours(),
      month = (NowDate.getMonth() + 1),
      year = NowDate.getFullYear(),
      date = NowDate.getDate();
    function Time() {
      NowDate = new Date(),
        sec = NowDate.getSeconds(),
        mins = NowDate.getMinutes(),
        hour = NowDate.getHours(),
        month = (NowDate.getMonth() + 1),
        year = NowDate.getFullYear(),
        date = NowDate.getDate();

      if (sec < 10) {
        sec = '0' + sec;
      }
      if (mins < 10) {
        mins = '0' + mins;
      }
      if (hour < 10) {
        hour = '0' + (hour);
      }



      setTimeout('Time()', 1000);
    }
  </script>
</head>

<body onload="Time()">
  <span hidden>å³æ™‚çš„ç·šä¸ŠèŠå¤©æ‡‰ç”¨ç¨‹å¼</span>
  <div id="logined-ui">



    <div class="collapse" id="navbarToggleExternalContent">
      <div class="bg-dark p-4">
        <div>

          <div class="flex">
            <div id="chat-tabs">


            </div>
            <div class="flex">
              <div>
                <div class="position-relative">
                  <svg xmlns="http://www.w3.org/2000/svg" style="width: 3em; height:3em; color:#fff" fill="currentColor"
                    class="bi bi-person-circle" viewBox="0 0 16 16">
                    <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
                    <path fill-rule="evenodd"
                      d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
                  </svg>
                  <span id="statue-circle"
                    class="position-absolute top-0 start-100 translate-middle p-2 bg-success border border-light rounded-circle">

                  </span>
                </div>
              </div>


              <ul style="color: #fff; margin-left: 1em;">
                <li hidden>
                  <form id="rename_nickname_farm" action="">
                    æš±ç¨±:<input id="NMinput" placeholder="è¼¸å…¥æš±ç¨±..." value="User">
                    <button id="changeNM" class="btn btn-outline-light">é€å‡ºæ›´æ”¹</button>
                  </form>
                </li>
                <li>
                  <h3 class="nickname"></h3>
                  <div class="flex">
                    <h6>@</h6>
                    <h6 id="Sid" style="margin:0">---</h6>
                  </div>
                </li>
                <li>
                  <form id="reset_statue_farm" action="">
                    ç‹€æ…‹:
                    <select id="statue_select" style="
                background-color: rgba(var(--bs-dark-rgb),var(--bs-bg-opacity)) !important;
                color: inherit;" onblur="
                if(this.value.includes('statue_Green')){$('#statue-circle').attr('class','position-absolute top-0 start-100 translate-middle p-2 bg-success border border-light rounded-circle')}
                else if(this.value.includes('statue_Yellow')){$('#statue-circle').attr('class','position-absolute top-0 start-100 translate-middle p-2 bg-warning border border-light rounded-circle')}
                else if(this.value.includes('statue_White')){$('#statue-circle').attr('class','position-absolute top-0 start-100 translate-middle p-2 bg-light border border-light rounded-circle')}
                else if(this.value.includes('statue_Red')){$('#statue-circle').attr('class','position-absolute top-0 start-100 translate-middle p-2 bg-danger border border-light rounded-circle')}
                else if(this.value.includes('statue_Blue')){$('#statue-circle').attr('class','position-absolute top-0 start-100 translate-middle p-2 bg-primary border border-light rounded-circle')}
                ">
                      <option value="statue_Green:online">ç·šä¸ŠğŸŸ¢</option>
                      <option value="statue_Yellow:leave">é›¢é–‹ğŸŸ¡</option>
                      <option value="statue_Red:busy">å¿™ç¢ŒğŸ”´</option>
                      <option value="statue_White:disconnect">é›¢ç·šâšª</option>
                    </select>


                  </form>

                </li>



                <li>é€£ç·šç‹€æ…‹: &nbsp; <span id="connectStatue">æœªé€£ç·š</span>
                </li>
                <li class="flex"><span>ç·šä¸Šäººæ•¸:&nbsp;</span><span class="onlinePeople">æœªçŸ¥</span></li>
              </ul>


            </div>

          </div>

          <div class="flex">
            <button class="btn btn-outline-light"
              onclick="$('#getuser-connecting').show();socket.emit('GetUsers',{'room':MyRoom})" data-bs-toggle="modal"
              data-bs-target="#Modal-1">äººå“¡æ¸…å–®</button>

            &nbsp;

            <button class="btn btn-outline-light" data-bs-toggle="modal" data-bs-target="#Modal-5" onclick='    $(".nickname").html(localStorage.getItem("myNickname"))
            $(".Sid").html(localStorage.getItem("myID"))'>è¨­å®š</button>
          </div>

        </div>
      </div>



    </div>

    <nav class="navbar navbar-dark bg-dark flex" style="position: sticky;
    width: 100%;
    top: 0;
    z-index: 1050;">

      <div class="container-fluid">
        <h1 style="color:#fff">CHAT</h1>
        <button class="navbar-toggler" type="button" onclick="window.scrollTo(0,0)" data-bs-toggle="collapse"
          data-bs-target="#navbarToggleExternalContent" aria-controls="navbarToggleExternalContent"
          aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>

      </div>
    </nav>






    <div class="d-flex align-items-start">
      <div class="nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">

        <button class="nav-link active" id="room-ctrl-1" data-bs-toggle="pill" data-bs-target="#room-tab-1"
          type="button" role="tab" aria-controls="room-tab-1" aria-selected="true" onclick="MyRoom = 'server'"
          data-room="server"><span>ğŸ”§èŠå¤©å®¤ç®¡ç†å“¡&nbsp;<span class='badge bg-secondary text-light'>æ©Ÿå™¨äºº</span>&nbsp;<span
              class='badge bg-success text-light'>å®˜æ–¹å¸³è™Ÿ</span><br><small>(@admin01)</small></span></button>
        <button class="nav-link" id="room-ctrl-add" data-bs-toggle="pill" data-bs-target="#room-tab-add" type="button"
          role="tab" aria-controls="room-tab-add" aria-selected="true">æ–°å¢</button>

      </div>
      <div class="tab-content" id="v-pills-tabContent">

        <div class="tab-pane fade show active" id="room-tab-1" role="tabpanel" aria-labelledby="room-ctrl-1"
          data-room="server">

          <div>
            <ul class="messages" data-room="server">
              <li>èŠå¤©å®¤:ä¼ºæœå™¨é€šçŸ¥

              </li>
              <li class="info">

                Tip:æŒ‰ä¸€ä¸‹å·¦é‚Šçš„é¸å–®ä»¥åˆ‡æ›ç¾¤çµ„<br>
                è¡Œå‹•è£ç½®ä½¿ç”¨è€…è«‹é»å³ä¸Šè§’çš„
                <svg style="max-width: 1em;" xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'>
                  <path stroke='rgba(0, 0, 0, 0.55)' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2'
                    d='M4 7h22M4 15h22M4 23h22' />
                </svg>
                ï¼Œé¸å–®æœƒé¡¯ç¤ºåœ¨å·¦å´
              </li>

            </ul>
          </div>
          <div class="bottom" data-room="server">
            <label id="isTypeing" style="backdrop-filter: blur(10px);background: rgba(0, 0, 0, 0.15);"></label>

            <div class="bottom-bar">

              <!--<button disabled class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#Modal-2"
                style="flex-shrink:1; min-width:90px"
                onclick='socket.emit("typeing",{"id":socket.id,"room":MyRoom});$("#statue-circle").attr("class","position-absolute top-0 start-100 translate-middle p-2 bg-primary border border-light rounded-circle")'>å‚³é€åœ–ç‰‡</button>
              &nbsp;
              <button disabled class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#Modal-3"
                style="flex-shrink:1; min-width:90px"
                onclick='socket.emit("typeing",{"id":socket.id,"room":MyRoom});$("#statue-circle").attr("class","position-absolute top-0 start-100 translate-middle p-2 bg-primary border border-light rounded-circle")''>å‚³é€æ–‡å­—</button>
              -->
              <button class="btn btn-outline-dark" disabled><i class="bi bi-list"></i></button>
              <form class="msg-form" action="" class="flex" style="width:100%">





                <input class="input" style="border: 1px #333 solid;" disabled autocomplete="off"
                  placeholder="ç„¡æ³•ç›´æ¥å‚³é€è¨Šæ¯çµ¦ğŸ”§èŠå¤©å®¤ç®¡ç†å“¡" oninput="
              socket.emit(' typeing', {'id':socket.id,'room':MyRoom});" onblur="
              socket.emit('typeing-end',{'id':socket.id,'room':MyRoom});">


                <button disabled class="btn btn-outline-dark">é€å‡ºè¨Šæ¯</button>
              </form>
            </div>
          </div>

        </div>


        <div class="tab-pane fade show" id="room-tab-add" role="tabpanel" aria-labelledby="room-ctrl-add">

          <div class='flex'>
            <div class='radio'><label onclick="
              if(document.getElementById('dl-file-1').checked){
                $('#createRoom').hide();
                $('#joinRoom').show();
                
              }"><input type='radio' id='dl-file-1' name='dl-radio'><span class='round button'>
                  <center>åŠ å…¥æˆ¿é–“</center>
                </span></label></div>

            <div class='radio'><label onclick="
              if(document.getElementById('dl-file-2').checked){
                $('#createRoom').show();
                $('#joinRoom').hide();
              }">
                <input type='radio' id='dl-file-2' name='dl-radio'><span class='round button'>
                  <center>å»ºç«‹æˆ¿é–“</center>
                </span></label>
            </div>

            <p></p><br>

          </div>
          <div id="createRoom">
            <span>è¼¸å…¥æˆ¿é–“åç¨±<input type="text" id="create-room-name"></span>
            <p><span>è¼¸å…¥æˆ¿é–“å¯†ç¢¼(è‹¥ä¸æƒ³è¨­å®šè«‹å‹¿è¼¸å…¥)<input type="password" id="create-room-pws"></span></p>
            <p><span>ç¢ºèªæˆ¿é–“å¯†ç¢¼<input type="password" id="create-room-pws-2"></span></p>
            <p>
            <div class="alert alert-danger">æˆ¿é–“å¯†ç¢¼è«‹å‹™å¿…ç‰¢è¨˜!</div>
            </p>

            <p>
            <div>
              <span>æˆ¿é–“è¨­å®š</span>
              <ul>
                <li>èª°å¯ä»¥è®Šæ›´è¨­å®š<br>

                  <input type="radio" class="btn-check" name="room-setting-radio-1" id="room-setting-radio-1/all"
                    autocomplete="off" checked value="@all">
                  <label class="btn btn-outline-primary" for="room-setting-radio-1/all">æ‰€æœ‰äºº</label>

                  <input type="radio" class="btn-check" name="room-setting-radio-1" id="room-setting-radio-1/me"
                    autocomplete="off" value="@me">
                  <label class="btn btn-outline-warning" for="room-setting-radio-1/me">æˆ‘</label>
                </li>
                <p></p>
                <li>èª°å¯ä»¥é‚€è«‹ç”¨æˆ¶<br>

                  <input type="radio" class="btn-check" name="room-setting-radio-2" id="room-setting-radio-2/all"
                    autocomplete="off" checked value="@all">
                  <label class="btn btn-outline-primary" for="room-setting-radio-2/all">æ‰€æœ‰äºº</label>

                  <input type="radio" class="btn-check" name="room-setting-radio-2" id="room-setting-radio-2/me"
                    autocomplete="off" value="@me">
                  <label class="btn btn-outline-warning" for="room-setting-radio-2/me">æˆ‘</label>
                </li>
                <p></p>
                <li>èª°å¯ä»¥ç§»é™¤ç”¨æˆ¶<br>
                  <span>ğŸ”§èŠå¤©å®¤ç®¡ç†å“¡&nbsp;<span class='badge bg-secondary text-light'>æ©Ÿå™¨äºº</span>&nbsp;<span
                      class='badge bg-success text-light'>å®˜æ–¹å¸³è™Ÿ</span>(@admin01) ä»¥åŠ</span>
                  <br>

                  <input type="radio" class="btn-check" name="room-setting-radio-3" id="room-setting-radio-3/all"
                    autocomplete="off" checked value="@all">
                  <label class="btn btn-outline-primary" for="room-setting-radio-3/all">æ‰€æœ‰äºº</label>

                  <input type="radio" class="btn-check" name="room-setting-radio-3" id="room-setting-radio-3/me"
                    autocomplete="off" value="@me">
                  <label class="btn btn-outline-warning" for="room-setting-radio-3/me">æˆ‘</label>
                </li>
                <p></p>
                <li>ç”¨æˆ¶åŠ å…¥æ–¹å¼<br>



                  <input type="checkbox" class="btn-check" id="room-setting-checkbox-1" autocomplete="off" checked
                    value="true">
                  <label class="btn btn-outline-primary" for="room-setting-checkbox-1">è¼¸å…¥å¯†ç¢¼</label>

                  <input type="radio" class="btn-check" name="room-setting-radio-4" id="room-setting-radio-4/invite"
                    autocomplete="off" checked>
                  <label class="btn btn-outline-primary" for="room-setting-radio-4/invite" value="invite">æ¥å—é‚€è«‹</label>

                  <input type="radio" class="btn-check" name="room-setting-radio-4" id="room-setting-radio-4/auto"
                    autocomplete="off">
                  <label class="btn btn-outline-warning" for="room-setting-radio-4/auto" value="auto">è‡ªå‹•åŠ å…¥</label>

                </li>
                <p></p>
                <li>
                  <div class="form-check form-switch" onclick="
                  if(document.getElementById('room-setting-checkbox-2').checked){
                    $('#room-setting-box-1').show()
                  }else{
                    $('#room-setting-box-1').hide()
                  }
                  
                  ">
                    <input class="form-check-input" checked type="checkbox" role="switch" id="room-setting-checkbox-2">
                    <label class="form-check-label" for="room-setting-checkbox-2">æ­¡è¿è¨Šæ¯</label>
                  </div>
                  <div id="room-setting-box-1">
                    è«‹è¼¸å…¥æ­¡è¿è¨Šæ¯:<input type="text" id="room-setting-input-1" placeholder="">
                    <p>
                    <div class="alert alert-info">å¦‚æœä¸è¨­å®šæ­¤æ ¼ï¼Œç³»çµ±å°‡ä½¿ç”¨é è¨­æ­¡è¿è¨Šæ¯</div>
                    </p>
                  </div>
                </li>



              </ul>
            </div>
            </p>

            <p><button class="btn btn-primary" onclick="
              if($('#create-room-name').val() == ''){
                $('#create-statue').append('è«‹è¼¸å…¥æˆ¿é–“åç¨±<br>')
              }else if($('#create-room-pws').val() !== $('#create-room-pws-2').val()){
                $('#create-statue').append('å…©æ¬¡è¼¸å…¥çš„å¯†ç¢¼ä¸åŒï¼Œè«‹é‡æ–°è¼¸å…¥<br>')
      
              }else if($('#create-room-name').val().includes(' ')){
                $('#create-statue').append('ç·¨è­¯å¤±æ•—!è«‹ä¸è¦ä½¿ç”¨ç©ºç™½ï¼Œå¯ä»¥ç”¨ä¸‹åº•ç·š(_)ä»£æ›¿<br>')
                
              }else if(text_type.includes($('#create-room-name').val())){
                $('#create-statue').append('ç·¨è­¯å¤±æ•—ï¼Œè«‹ä¸è¦ä½¿ç”¨å¼•è™Ÿ')
              }else if($('#create-room-name').val().includes('<') || $('#create-room-name').val().includes('>')){
                $('#create-statue').append('ç·¨è­¯å¤±æ•—!è«‹ä¸è¦ä½¿ç”¨å°–æ‹¬è™Ÿ <><br>')
              }else if($('#create-room-pws').val() == $('#create-room-pws-2').val()){
                $('#create-statue').append('æˆ¿é–“åç¨±: '+$('#create-room-name').val()+'<br>')
      
                $('#create-statue').append('æ­£åœ¨æ–°å¢æˆ¿é–“ï¼Œè«‹å…ˆä¸è¦åˆ·æ–°é é¢<br>')
                let arr = []
                for(let i=0;i<2;i++){//0.1.2
                  if($(`[name=room-setting-radio-${i+1}]`).val() == '@me'){
                    arr.push('@'+localStorage.getItem('myID'))
                  }else{
                    arr.push($(`[name=room-setting-radio-${i+1}]`).val())
                  }
                }

               if(document.getElementById('room-setting-checkbox-1').checked){
                 arr.push(true)
               }else{
                arr.push(false)
               }
                
                arr.push($('[name=room-setting-radio-4]').val())                    //4
                arr.push(document.getElementById('room-setting-checkbox-2').checked)//5
                console.log(arr)
                if(document.getElementById('room-setting-checkbox-2').checked){

                  
                  socket.emit('create',
                {
                'name':$('#create-room-name').val(),
                'pws':$('#create-room-pws').val(),
                'setting':{
                  'change':arr[0],
                  'invite':arr[1],
                  'remove':arr[2],
                  'how_to_join':{'pws':arr[3],'invite':arr[4]},
                  'welcome_msg':$('#room-setting-input-1').val()
                }
              
              })
                }else{
                socket.emit('create',
                {
                'name':$('#create-room-name').val(),
                'pws':$('#create-room-pws').val(),
                'setting':{
                  'change':arr[0],
                  'invite':arr[1],
                  'remove':arr[2],
                  'how_to_join':{'pws':arr[3],'invite':arr[4]}
                }
              
              })
            }
              }
              
              
              
              
              ">ç¢ºå®š</button></p>
            <p><span id="create-statue"></span></p>
          </div>
          <div id="joinRoom">
            <span>è¼¸å…¥æˆ¿é–“ID<input type="text" id="join-room-name" value="@room-"></span>
            <p><span>è¼¸å…¥æˆ¿é–“å¯†ç¢¼<input type="password" id="join-room-pws"></span></p>

            <p>
            <div id="join-alert-2" class="alert alert-danger">è«‹å‹¿é‡è¤‡åŠ å…¥åŒä¸€æˆ¿é–“!</div>
            </p>
            <p><button class="btn btn-primary" onclick="
              if(RoomID.includes($('#join-room-name').val())){

             $('#join-statue').append('ä½ å·²ç¶“åŠ å…¥äº†æ­¤æˆ¿é–“<br>') }
              else{
                    socket.emit('join',{'id':localStorage.getItem('myID'),'nickname':localStorage.getItem('myNickname'),'room':$('#join-room-name').val(),'pws':$('#join-room-pws').val()})
              $('#join-statue').append('æ­£åœ¨é€£ç·šåˆ°èŠå¤©å®¤:'+$('#join-room-name').val()+'<br>')
              }
              ">ç¢ºå®š</button></p>
            <p><span id="join-statue"></span></p>
          </div>


        </div>


      </div>

    </div>









  </div>

  <div id="login-ui-1" style="display: none;">
    <h1>æ­¡è¿ä¾†åˆ°CHAT</h1>
    <h5>æˆ‘å€‘è©²å¦‚ä½•ç¨±å‘¼æ‚¨?</h5>
    <span>
      <p></p>
      <div class="form-floating mb-3">
        <input type="text" class="form-control" id="nickname-input-set" placeholder="è«‹è¼¸å…¥æš±ç¨±">
        <label for="floatingInput">è«‹è¼¸å…¥æš±ç¨±</label>
      </div>
    </span><br>
    <span class="badge bg-primary">
      <h6>é€™æ˜¯æ‚¨åœ¨CHATé¡¯ç¤ºçš„åç¨±ï¼Œä¹Ÿæ˜¯ä»–äººèªå¾—æ‚¨çš„æ–¹å¼</h6>
    </span>
    <p></p><span class="badge bg-danger">
      <h6>è«‹æ³¨æ„:æš±ç¨±ç„¡æ³•ä¿®æ”¹</h6>
    </span>
    <p></p><span class="badge bg-danger" id="set-alert" style="display: none;">
      <h6>**æœ€å¾Œä¸€å€‹å­—ç¬¦ä¸å¯ä»¥æ˜¯ç©ºç™½**</h6>
    </span>
    <p></p><span class="badge bg-danger" id="set-alert-2" style="display: none;">
      <h6>**è«‹å¡«å¯«æš±ç¨±**</h6>
    </span>

    <p></p><span class="badge bg-danger" id="set-alert-3" style="display: none;">
      <h6>ç·¨è­¯å¤±æ•—!è«‹ä¸è¦ä½¿ç”¨å°–æ‹¬è™Ÿ <>
      </h6>
    </span>
    <p></p><span class="badge bg-success" id="set-info" style="display: none;">
      <h6>è®Šæ›´å·²ç¶“å„²å­˜ï¼Œæ­£åœ¨å‘ä¼ºæœå™¨ç¢ºèªä½ çš„IDï¼Œè«‹å…ˆ<B>ä¸è¦</B>åˆ·æ–°ç¶²é </h6>
    </span>
    <p></p><span class="badge bg-success" id="set-info-2" style="display: none;">
      <h6></h6>
    </span>
    <p></p>
    <button class="btn btn-secondary" onclick="
  if($('#nickname-input-set').val().slice(-1) == ' '){
    $('#set-alert').show()
  }
  else if($('#nickname-input-set').val() == ''){
    $('#set-alert-2').show()
  }
  else if($('#nickname-input-set').val().includes('>') || $('#nickname-input-set').val().includes('<')){
    $('#set-alert-3').show()
  }
  else{
    localStorage.setItem('CHAT', true)
    localStorage.setItem('myNickname',$('#nickname-input-set').val())
    socket.connect()
    socket.emit('GetID', { 'from': socket.id })
    $('#set-info').show()
    $(this).attr('disabled',true)
  }">ç¢ºå®š</button>
  </div>




  <!-- Modal + contextmenu-->
  <div class="modal fade" id="Modal-1" tabindex="-1" aria-labelledby="Modal-1Label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="Modal-1Label">ç·šä¸Šäººå“¡</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">


          <p>ç·šä¸Šäººæ•¸:<span class="onlinePeople"></span></p>

          <table>
            <thead>
              <tr>
                <td>æš±ç¨±</td>
                <td>ID</td>
                <td>ç‹€æ…‹</td>

              </tr>
            <tbody id="PeopleOnLine">
              <td colspan="3">æ­£åœ¨å–å¾—è³‡æ–™...</td>
            </tbody>
          </table>
          <br>
          <p><button class="btn btn-outline-primary"
              onclick="$('#getuser-connecting').show(); socket.emit('GetUsers',{'room':MyRoom})">é‡æ–°æ•´ç†</button></p>
          <br>
          <p><span class="badge bg-primary " id="getuser-connecting">æ­£åœ¨é€£ç·š...</span></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">é—œé–‰</button>

        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="Modal-2" tabindex="-1" aria-labelledby="Modal-2Label" aria-hidden="true"
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="Modal-2Label">å‚³é€åœ–ç‰‡</h5>
          <button type="button" onclick='socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})' class="btn-close"
            data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <span class=" btn-file btn btn-secondary">


            é¸æ“‡æª”æ¡ˆ <input type="file" id="upload-input" accept="image/jpeg, image/png">

          </span>

          <img onerror="isfile = false" id="img">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
            onclick='socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})'>é—œé–‰</button>
          <button type="button" class="btn btn-warning" data-bs-dismiss="modal" onclick='
                  if(isfile){
                  let filename =  document.getElementById("upload-input").files[0].name                                                                        
                  socket.emit("send img",{"src":img.attr("src"),"filename":filename,"to":MyRoom})
                  console.log(img.attr("src"))
                  socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})
                  //$("#statue-circle").attr("class","position-absolute top-0 start-100 translate-middle p-2 bg-success border border-light rounded-circle")
                  }
                  '>é€å‡º</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="Modal-3" tabindex="-1" aria-labelledby="Modal-3Label" aria-hidden="true"
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="Modal-3Label">å‚³é€æ–‡å­—æª”</h5>
          <button type="button" onclick='socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})' class="btn-close"
            data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <span class=" btn-file btn btn-secondary">


            é¸æ“‡æª”æ¡ˆ <input type="file" id="upload-input-txt" accept="text/plain , .txt">

          </span>

          <pre class="text" id="txt-preview"></pre>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
            onclick='socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})'>é—œé–‰</button>
          <button type="button" class="btn btn-warning" data-bs-dismiss="modal" onclick='
              
                   let filename =  document.getElementById("upload-input-txt").files[0].name  
                  socket.emit("send txt",{"src":txtfile,"filename":filename,"to":MyRoom})
                  
                  socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})
                //  $("#statue-circle").attr("class","position-absolute top-0 start-100 translate-middle p-2 bg-success border border-light rounded-circle")
                
                  '>é€å‡º</button>

        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="Modal-4" tabindex="-1" aria-labelledby="Modal-4Label" aria-hidden="true"
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="Modal-4Label">å‚³é€é€£çµ</h5>
          <button type="button" onclick='socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})' class="btn-close"
            data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">




          <div class="input-group mb-3">
            <span class="input-group-text">https://</span>
            <input type="text" class="form-control" id="link-url" aria-describedby="basic-addon3">
          </div>

          <div class="alert alert-danger">è«‹å‹¿å‚³é€æƒ¡æ„é€£çµï¼Œä¸¦è«‹å…ˆç¢ºå®šçœŸå¯¦æ€§å†è½‰è²¼</div>
          <a href="https://cofacts.tw/">å‡è¨Šæ¯æŸ¥è­‰</a>&nbsp;<a href="https://www.scamadviser.com/">é€£çµå®‰å…¨æ€§æŸ¥è­‰</a>
          <div class="alert alert-warning" id="link-alert" style="display: none;">è«‹è¼¸å…¥é€£çµ!</div>



          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
              onclick='socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})'>é—œé–‰</button>

            <button type="button" class="btn btn-warning" data-bs-dismiss="modal" onclick=' 
            if($("#link-url").val() !== ""){
              $("#link-alert").hide()
            socket.emit("send link",{"src":$("#link-url").val(),"to":MyRoom})
                  
            socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})
            }else{
              $("#link-alert").show()
            }'>é€å‡º</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="Modal-5" tabindex="-1" aria-labelledby="Modal-5Label" aria-hidden="true"
    data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="Modal-5Label">ç³»çµ±è¨­å®š</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="flex">
            <svg xmlns="http://www.w3.org/2000/svg" style="width: 3em; height:3em;" fill="currentColor"
              class="bi bi-person-circle" viewBox="0 0 16 16">
              <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0z" />
              <path fill-rule="evenodd"
                d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1z" />
            </svg>
            &nbsp;
            <div>
              <h3 class="nickname"></h3>
              <div class="flex">
                <h6>@</h6>
                <h6 class="Sid" style="margin:0">---</h6>

              </div>
            </div>
          </div>
          <p></p>
          <h3>å€‹äººè¨­å®š</h3>
          <h4>é€šçŸ¥</h4>
          <span>é€šçŸ¥æ™‚æ©Ÿ</span>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="setting-1-1">
            <label class="form-check-label" for="setting-1-1">
              èŠå¤©å®¤æœ‰æ–°è¨Šæ¯
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="setting-1-2">
            <label class="form-check-label" for="setting-1-2">
              æœ‰äººåŠ å…¥èŠå¤©
            </label>
          </div>
          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="setting-1-3">
            <label class="form-check-label" for="setting-1-3">
              æœ‰äººé›¢é–‹èŠå¤©
            </label>
          </div>

          <div class="form-check">
            <input class="form-check-input" type="checkbox" value="" id="setting-1-4">
            <label class="form-check-label" for="setting-1-4">
              æ­¡è¿è¨Šæ¯(åŠ å…¥èŠå¤©å®¤)
            </label>
          </div>

          <p>
          <h3>é—œæ–¼</h3>

          <div class="flex" style="user-select: none;">

            <img src="/icon/icon.png" style="max-height:50px;max-width: 50px;" id="logo-img">
            <pre>
 CHAT - v1.0
 Jerry - 2022.7


                            </pre>
          </div>
          </p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
          <button type="button" class="btn btn-warning" data-bs-dismiss="modal">ç¢ºå®š</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="Modal-6" tabindex="-1" aria-labelledby="Moda-6Label" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="Modal-6Label">å‚³é€åª’é«”</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">

          <p>è«‹æ–¼ä¸‹æ–¹é¸æ“‡è¦å‚³é€çš„åª’é«”é¡åˆ¥</p>

          <p>
            <button class="btn btn-outline-primary" data-bs-target="#Modal-2" data-bs-toggle="modal">åœ–ç‰‡</button>
          </p>
          <p>
            <button class="btn btn-outline-primary" data-bs-target="#Modal-3" data-bs-toggle="modal">æ–‡å­—æ–‡ä»¶</button>
          </p>
          <p>
            <button class="btn btn-outline-primary" data-bs-target="#Modal-4" data-bs-toggle="modal">é€£çµ</button>
          </p>

          <p>
            <button class="btn btn-outline-primary" data-bs-target="#Modal-7" data-bs-toggle="modal">è¡Œç¨‹è³‡è¨Š</button>
          </p>

          <p>
            <button class="btn btn-outline-primary" data-bs-target="#Modal-8" data-bs-toggle="modal">æŠ•ç¥¨</button>
          </p>
        </div>
        <div class="modal-footer">


          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
            onclick='socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})'>é—œé–‰</button>


        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="Modal-7" tabindex="-1" aria-labelledby="Moda-7Label" aria-hidden="true"
    data-bs-keyboard="false" data-bs-backdrop="static">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="Modal-7Label">å‚³é€è¡Œç¨‹</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="card">
            <div class="card-header">
              è¡Œç¨‹æ—¥æœŸ:

              <div class="form-floating">
                <input type="datetime-local" class="form-control" id="event-start-time" placeholder="è¡Œç¨‹é–‹å§‹æ™‚é–“">
                <label for="event-title">è¡Œç¨‹é–‹å§‹æ™‚é–“</label>
              </div>
              &nbsp;
              <div class="form-floating">
                <input type="datetime-local" class="form-control" id="event-end-time" placeholder="è¡Œç¨‹çµæŸæ™‚é–“">
                <label for="event-end-time">è¡Œç¨‹çµæŸæ™‚é–“</label>
              </div>

            </div>
            <div class="card-body">
              <h5 class="card-title">

                <div class="form-floating">
                  <input type="text" class="form-control" id="event-title" placeholder="è¡Œç¨‹åç¨±">
                  <label for="event-title">è¡Œç¨‹åç¨±</label>
                </div>

              </h5>
              <p class="card-text">

              <div class="form-floating">
                <textarea class="form-control" placeholder="è¡Œç¨‹èªªæ˜" id="event-text"></textarea>
                <label for="event-text">è¡Œç¨‹èªªæ˜</label>
              </div>
              </p>

            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
            onclick='socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})'>é—œé–‰</button>

          <button type="button" class="btn btn-warning" data-bs-dismiss="modal" onclick=' 

       // socket.emit("send link",{"src":$("#link-url").val(),"to":MyRoom})
       socket.emit("send event",{

        "to":MyRoom,
        "event_start_time":($("#event-start-time").val()).replace("T","&nbsp;"),
        "event_end_time":($("#event-end-time").val()).replace("T","&nbsp;"),
        "event_title":$("#event-title").val(),
        "event_text":$("#event-text").val()
       })
        socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})'>é€å‡º</button>

        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="Modal-8" tabindex="-1" aria-labelledby="Modal-8Label" aria-hidden="true"
    data-bs-keyboard="false" data-bs-backdrop="static">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="Modal-8Label">æŠ•ç¥¨</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="card">
            <div class="card-header">
              æ–°å¢æŠ•ç¥¨
            </div>
            <div class="card-body">
              <h5 class="card-title">
                <div class="form-floating">
                  <input type="text" class="form-control" id="vote-title" placeholder="æŠ•ç¥¨åç¨±">
                  <label for="vote-title">æŠ•ç¥¨åç¨±</label>
                </div>
              </h5>
              <p class="card-text">
                <span>
                  <div class="form-floating">
                    <input type="text" class="form-control" id="vote-text" placeholder="æŠ•ç¥¨èªªæ˜">
                    <label for="vote-text">æŠ•ç¥¨èªªæ˜</label>
                  </div>
                </span><br>
                <p></p>
              <div id="vote-tickets" data-tickets="2">
                <div class="form-floating">
                  <input type="text" class="form-control" id="vote-ticket-1" placeholder="é¸é …1">
                  <label for="vote-ticket-1">é¸é …1</label>
                </div>
                <div class="form-floating">
                  <input type="text" class="form-control" id="vote-ticket-2" placeholder="é¸é …2">
                  <label for="vote-ticket-2">é¸é …2</label>
                </div>

              </div>
              <p></p>
              <button class="btn btn-primary" onclick="
           
                  n = Number($('#vote-tickets').attr('data-tickets'))+1
                  $('#vote-tickets').append(`
               
                  <div class='form-floating'>
                    <input type='text' class='form-control' id='vote-ticket-${n}' placeholder='é¸é …${n}'>
                    <label for='vote-ticket-${n}'>é¸é …${n}</label>
                  </div>
                  `)
                  $('#vote-tickets').attr('data-tickets',n)
                  if(Number($('#vote-tickets').attr('data-tickets')) >=5){

                    $(this).attr('disabled',true)
                  }
                

                ">æ–°å¢é¸é …</button>
              </p>

            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
            onclick='socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})'>é—œé–‰</button>

          <button type="button" class="btn btn-warning" data-bs-dismiss="modal" onclick=' 

       // socket.emit("send link",{"src":$("#link-url").val(),"to":MyRoom})
       socket.emit("send event",{

        "to":MyRoom,
        "event_start_time":($("#event-start-time").val()).replace("T","&nbsp;"),
        "event_end_time":($("#event-end-time").val()).replace("T","&nbsp;"),
        "event_title":$("#event-title").val(),
        "event_text":$("#event-text").val()
       })
        socket.emit("typeing-end",{"id":socket.id,"room":MyRoom})'>é€å‡º</button>

        </div>
      </div>
    </div>
  </div>

  <div id="contextmenu" style="display: none;">
    <div id="content-tool"></div>
    <ul id="contextmenu-ul">

    </ul>


  </div>


  <div id="toast" class="position-fixed bottom-0 end-0 p-3 toast-container">


  </div>




  <script src="/socket.io/socket.io.js"></script>
  <!-- <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>-->
  <script src="/js/jquery.js"></script>

  <!--BS5 JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ"
    crossorigin="anonymous"></script>
  <script>
    var socket = io();

    var messages = document.getElementById('messages');
    var form = $(".msg-form")
    var input = document.getElementById('input');
    var rename_nickname_farm = document.getElementById('rename_nickname_farm');
    var input_focus = false
    var input_room = ''

    var my_nickname = ""
    var last_nickname = ""
    var isConnected = false

    var MyRoom
    var RoomList = []
    var RoomID = []
    var room_num = 1

    var notifications = false

    var text_type = ['"', "'", '`']

    //ç§»å‹•è£ç½®æª¢æ¸¬
    window.mobileAndTabletCheck = function () {
      let check = false;
      (function (a) { if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true; })(navigator.userAgent || navigator.vendor || window.opera);
      return check;
    };
    (function ($) {
      $.UrlParam = function (name) {
        //å®£å‘Šæ­£è¦è¡¨é”å¼
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
        /*
         * window.location.search ç²å–URL ?ä¹‹å¾Œçš„åƒæ•¸(åŒ…å«å•è™Ÿ)
         * substr(1) ç²å–ç¬¬ä¸€å€‹å­—ä»¥å¾Œçš„å­—ä¸²(å°±æ˜¯å»é™¤æ‰?è™Ÿ)
         * match(reg) ç”¨æ­£è¦è¡¨é”å¼æª¢æŸ¥æ˜¯å¦ç¬¦åˆè¦æŸ¥è©¢çš„åƒæ•¸
        */
        var r = window.location.search.substr(1).match(reg);
        //å¦‚æœå–å‡ºçš„åƒæ•¸å­˜åœ¨å‰‡å–å‡ºåƒæ•¸çš„å€¼å¦å‰‡å›ç©¿null
        if (r != null) return (r[2]); return null;
      }
    })(jQuery);
    if (window.mobileAndTabletCheck() && $.UrlParam("mobile") == null) {
      if (location.href.slice(-1) == "/") {
        location.href = location.href + "?mobile=true"
      } else {
        location.href = location.href + "/?mobile=true"
      }
    }





    //local
    if (localStorage.getItem("CHAT") == null) {
      $("#login-ui-1").show()
      $("#logined-ui").hide()


    } else {
      $("#createRoom,#joinRoom").hide();
      $(".nickname").html(localStorage.getItem("myNickname"))

      socket.emit('join', { 'id': localStorage.getItem('myID'), 'nickname': localStorage.getItem('myNickname'), 'room': '@room-1', 'pws': '' })



    }

    socket.on("PostID", function (id) {
      localStorage.setItem("myID", id)
      $("#Sid").html(id)
      $("#set-info-2").html("<h6>è«‹è¨˜ä¸‹ä½ çš„ID: " + id + "ï¼Œç¾åœ¨ä½ å¯ä»¥åˆ·æ–°ç¶²é ä¾†åŠ å…¥èŠå¤©äº†</h6>").show()
      socket.disconnect()

    })
    socket.on("password incorrect", function (room) {
      $('#join-statue').append("è¼¸å…¥çš„èŠå¤©å®¤IDæˆ–å¯†ç¢¼éŒ¯èª¤<br>")

    })
    socket.on("room not found", function (room) {
      $('#join-statue').append("æ‰¾ä¸åˆ°èŠå¤©å®¤: " + room + "<br>")

    })
    socket.on("room blocked", function (room) {
      $('#join-statue').append("èŠå¤©å®¤ " + room + "æ‹’çµ•é€£ç·š<br>")

    })

    socket.on("welcome", function (room) {
      if (room.id !== '@room-1') {
        $('#join-statue').append("æ­¡è¿é€²å…¥èŠå¤©å®¤: " + room.name + "<br>");
        RoomList.push(room.name)
        RoomID.push(room.id)
      }
      MyRoom = room.name
      RoomID.push(room.id)
      socket.emit("statue", { "statue": $("#statue_select").val() })
      socket.emit('GetUsers', { 'room': MyRoom })
      $("#login-ui-2").hide();
      $("#login-ui-1").hide();
      $("#logined-ui").show();
      RoomList.push(room.name)
      //$(".messages").html("<li>èŠå¤©å®¤:" + MyRoom + " (" + $("#join-room-name").val() + " )</li>")

      $("#Sid").html(localStorage.getItem("myID"))
      room_num++
      $("#room-ctrl-add").before(`<button class="nav-link" id="room-ctrl-${room_num}" data-bs-toggle="pill" data-bs-target="#room-tab-${room_num}" type="button" role="tab" aria-controls="room-tab-${room_num}" aria-selected="true" onclick="MyRoom = $(this).attr('data-room');console.log($(this).attr('data-room'))" data-room=${(MyRoom)}>${MyRoom}<br><small>(${room.id})</small></button>`)
      $("#room-tab-add").before(`<div class="tab-pane fade show" id="room-tab-${room_num}" role="tabpanel" aria-labelledby="room-ctrl-${room_num}" data-room="${(MyRoom)}"></div>`)
      $("#room-tab-" + room_num).html(`
      <div>
            <ul class="messages" data-room="${MyRoom}">
              <li>èŠå¤©å®¤:${MyRoom} (${room.id})</li>

            </ul>
          </div>
          <div class="bottom" data-room="${MyRoom}">
            <label id="isTypeing" style="backdrop-filter: blur(10px);background: rgba(0, 0, 0, 0.15);"></label>

            <div class="bottom-bar">

<button class="btn btn-outline-dark" data-bs-toggle="modal" data-bs-target="#Modal-6"> <i class="bi bi-list"></i></button>

          <div class="msg-form" action="" class="flex" style="width:100%">
    
    
    
    
    
            <input class="input" autocomplete="off" data-room=${MyRoom} placeholder="è¼¸å…¥æ–°è¨Šæ¯" 
            onfocus="input_focus=true; input_room = MyRoom"
            oninput="
              socket.emit(' typeing', {'id':socket.id,'room':MyRoom});
              input_room = MyRoom
                "
                onblur="
              socket.emit('typeing-end',{'id':socket.id,'room':MyRoom});
              input_focus = false;
              input_room = MyRoom
              ">


                <button class="btn btn-outline-dark"
                onclick="submit_chat(MyRoom)"
                
                
                
                
                >é€å‡ºè¨Šæ¯</button>
                </div>
            </div>
          </div>

      
      
      
      `)
      $(`room-ctrl-${room_num}`).click()

      $(".bottom").css("width", $(".tab-content").css("width"))

      try {
        BS_Toast.show({ "title": "æ­¡è¿åŠ å…¥&nbsp;" + room.name, "img": "bi-bell-fill" }, { "html": room.msg.replace("<!s>", "&nbsp;").replace(">", "&gt;").replace("<", "&lt;") })
      } catch (e) {
        console.log(e)
        BS_Toast.show({ "title": "æ­¡è¿åŠ å…¥&nbsp;" + room.name, "img": "bi-bell-fill" }, { "html": "æ­¡è¿åŠ å…¥&nbsp;" + room.name })

      }

    })

    socket.on("created", msg => {
      $('#create-statue').append('æˆ¿é–“ ' + msg.name + "å·²ç¶“å»ºç«‹å®Œæˆ<br>IDæ˜¯: " + msg.id + '<br>åˆ‡æ›åˆ° åŠ å…¥ ä»¥åŠ å…¥æ­¤æˆ¿é–“<br>')
      $("#join-room-name").val(msg.id)
      $("#join-room-pws").val(msg.pws)
    })

    socket.on("create err", function (msg) {
      $('#create-statue').append('æˆ¿é–“åç¨± ' + msg.name + " å·²ç¶“è¢«ä½¿ç”¨ï¼Œ" + 'è«‹å†è©¦ä¸€æ¬¡<br>')
    })

    //img input
    var img = $('#img');
    var isfile = false
    img.css('display', 'none');



    function readfichier(e) {
      if (window.FileReader) {
        var file = e.target.files[0];
        var reader = new FileReader();
        if (file && file.type.match('image.*')) {
          reader.readAsDataURL(file);
          isfile = true;
        } else {
          img.css('display', 'none');
          img.attr('src', '');
        }
        reader.onloadend = function (e) {
          img.attr('src', reader.result);
          img.css('display', 'block');

          img.css("max-width", (img.parent().width() - 15))
        }
      }
    }

    document.getElementById('upload-input').addEventListener('change', readfichier, false);



    //txt input

    var istxtfile = false
    var preview_txt = $("#txt-preview")
    var txtfile = ""


    function treadfichier(e) {
      if (window.FileReader) {
        var tfile = e.target.files[0];
        var treader = new FileReader();
        if (tfile) {
          treader.readAsText(tfile);
          istxtfile = true;
        } else {

        }
        treader.onloadend = function (e) {
          preview_txt.html(treader.result)
          txtfile = treader.result



        }
      }
    }

    document.getElementById('upload-input-txt').addEventListener('change', treadfichier, false);


    $(`.input[data-room=${MyRoom}]`).on('input', function () {
      console.log(`.input[data-room=${MyRoom}]`)
    })




    function submit_chat(room) {
      console.log({ 'msg': ($(`.input[data-room=${room}]`).val()).replace(/\n/g, '<!b>').replace(/\t/g, '<!t>').replace(/ /g, '<!s>'), 'room': room })
      if ($(`.input[data-room=${room}]`).val() !== '') {
        socket.emit('chat message room', { 'msg': ($(`.input[data-room=${room}]`).val()).replace(/\n/g, '<!b>').replace(/\t/g, '<!t>').replace(/ /g, '<!s>'), 'room': room });
        if (!isConnected) {

          $(`.msssages[data-room=${room}]`).append('<li class="warn">' + "è¨Šæ¯ç™¼é€å¤±æ•—! ç„¡æ³•ç™¼é€çš„è¨Šæ¯: " + $(`.input[data-room=${room}]`).val() + '</li>')

          window.scrollTo(0, document.body.scrollHeight);
        }
        //input.value = '';
        socket.emit("typeing-end", { 'id': socket.id, 'room': room })

        $(`.input[data-room=${room}]`).val("")
      }
    }
    window.onkeydown = function (e) {
      if (e.keyCode == 13 && input_focus) {
        submit_chat(input_room)
      }

    }
    //Do Not Use The Code Below (JQ BUG in submit)
    form.on('submit', function () {
      //  e.preventDefault();
      if ($(`.input[data-room=${MyRoom}]`).val() !== '') {
        socket.emit('chat message room', { 'msg': ($(`.input[data-room=${MyRoom}]`).val()).replace(/\n/g, '<!b>').replace(/\t/g, '<!t>').replace(/ /g, '<!s>'), 'room': MyRoom });
        if (!isConnected) {

          $(`.msssages[data-room=${MyRoom}]`).append('<li class="warn">' + "è¨Šæ¯ç™¼é€å¤±æ•—! ç„¡æ³•ç™¼é€çš„è¨Šæ¯: " + $(`.input[data-room=${MyRoom}]`).val() + '</li>')

          window.scrollTo(0, document.body.scrollHeight);
        }
        //input.value = '';
        socket.emit("typeing-end", { 'id': socket.id, 'room': MyRoom })

      }
    });
    /////////////////////////////
    rename_nickname_farm.addEventListener('submit', function (e) {
      e.preventDefault();
      if (document.getElementById("NMinput").value && document.getElementById("NMinput").value !== my_nickname) {
        socket.emit('rename_nickname', document.getElementById("NMinput").value);
        last_nickname = my_nickname
        my_nickname = document.getElementById("NMinput").value

        if (!isConnected) {

          $(".messages").append("<li>: ( èˆ‡ä¼ºæœå™¨é€£æ¥å¤±æ•—!</li>")

          window.scrollTo(0, document.body.scrollHeight);
        }
      }
    });

    $("#statue_select").on("blur", function () {
      socket.emit("statue", { "statue": $("#statue_select").val(), "room": MyRoom })
    })

    socket.on("UserList", function (msg) {
      if (msg.to == MyRoom) {
        $("#PeopleOnLine").html("")
        let count = 0
        console.log(msg)

        for (let r = 0; r < (msg.userID).length; r++) {

          if (msg.nickname !== undefined && msg.nickname !== null && msg.userID !== null) {
            let _statue = msg.statue[r]
            if (_statue == "ç·šä¸Š") { _statue = "ğŸŸ¢ " + _statue }
            else if (_statue == "é›¢é–‹") { _statue = "ğŸŸ¡ " + _statue }
            else if (_statue == "å¿™ç¢Œ") { _statue = "ğŸ”´ " + _statue }
            else if (_statue == "é›¢ç·š") { _statue = "âšª " + _statue }
            $("#PeopleOnLine").append("<tr>" + "<td>" + msg.nickname[r] + "</td>" + "<td>" + msg.userID[r] + "</td>" + "<td>" + _statue + "</td>" + "</tr>")
            count++
          } else {

          }

        }
        if (msg.self == true) {
          let _statue = $("#statue_select").val()
          if (_statue.includes("online")) { _statue = "ğŸŸ¢ " + _statue }
          else if (_statue.includes("leave")) { _statue = "ğŸŸ¡ " + _statue }
          else if (_statue.includes("busy")) { _statue = "ğŸ”´ " + _statue }
          else if (_statue.includes("disconnect")) { _statue = "âšª " + _statue }
          $("#PeopleOnLine").append("<tr>" + "<td>" + localStorage.getItem("myNickname") + "</td>" + "<td>" + localStorage.getItem("myID") + "</td>" + "<td>" + $("#statue_select") + "</td>" + "</tr>")
          count++
        }
        $(".onlinePeople").html(count);
        $('#getuser-connecting').hide();

      }
      count = 0;


    })

    socket.on('chat message room', function (msg) {

      if (RoomList.includes(msg.room)) {


        if (msg.room == MyRoom) {

          $(`.messages[data-room=${msg.room}]`).append(`<li id='chat-msg-${msg.count}'>${msg.msg.replace(/<!b>/g, '<br>').replace(/<!t>/g, '&nbsp;&nbsp;&nbsp;&nbsp;').replace(/<!s>/g, '&nbsp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</li>`)
          isConnected = true


          window.scrollTo(0, document.body.scrollHeight);
        } else {
          BS_Toast.show({ 'title': msg.room + ' æœ‰æ–°è¨Šæ¯', 'time': 'ç¾åœ¨', 'img': 'bi-chat-left-text-fill' }, { 'html': (msg.msg).replace(/<!b>/g, '<br>').replace(/<!t>/g, '&nbsp;&nbsp;&nbsp;&nbsp;').replace(/<!s>/g, '&nbsp;').replace(/</g, '&lt;').replace(/>/g, '&gt;') })
          $(`.messages[data-room=${msg.room}]`).append(`<li id='chat-msg-${msg.count}'>${msg.msg.replace(/<!b>/g, '<br>').replace(/<!t>/g, '&nbsp;&nbsp;&nbsp;&nbsp;').replace(/<!s>/g, '&nbsp;').replace(/</g, '&lt;').replace(/>/g, '&gt;')}</li>`)
          isConnected = true
          $(`#chat-msg-${msg.count}`).html(msg.msg.replace(/<!b>/g, '<br>').replace(/<!t>/g, '&nbsp;&nbsp;&nbsp;&nbsp;').replace(/<!s>/g, '&nbsp;').replace(/</g, '&lt;').replace(/>/g, '&gt;'))

        }


      }
    });

    socket.on('send img', function (msg) {


      if (RoomList.includes(msg.to)) {
        if (msg.to == MyRoom) {
          $(`.messages[data-room=${MyRoom}]`).append("<li>" + msg.text + "<br>æª”æ¡ˆåç¨±:" + msg.filename.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "<p></p><img src='" + msg.src + "' id='" + msg.id + "' alt='" + msg.alt + "'></li>")
          window.scrollTo(0, document.body.scrollHeight);
          isConnected = true
          $("#" + msg.id).css("max-width", ($(`.messages[data-room=${MyRoom}]`).css("widih") - 50))
        } else {
          BS_Toast.show({ 'title': msg.to + ' æœ‰æ–°è¨Šæ¯', 'time': 'ç¾åœ¨', 'img': 'bi-chat-left-text-fill' }, { 'html': msg.head })
          $(`.messages[data-room=${msg.to}]`).append("<li>" + msg.text + "<br>æª”æ¡ˆåç¨±:" + msg.filename.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "<p></p><img src='" + msg.src + "' id='" + msg.id + "' alt='" + msg.alt + "'></li>")

          isConnected = true
          $("#" + msg.id).css("max-width", ($(`.messages[data-room=${MyRoom}]`).css("widih") - 50))
        }
      }
    });



    socket.on('send link', function (msg) {


      if (RoomList.includes(msg.to)) {
        if (msg.to == MyRoom) {
          $(`.messages[data-room=${MyRoom}]`).append("<li>" + `
          ${msg.text}<br>
          <a href='https://${msg.src}' target="_blank" style="text-decoration: none;">
          <div class="input-group mb-3">
            <span class="input-group-text">https://</span>
            <input readonly style="cursor:pointer;" type="text" class="form-control" value='${msg.src}'>
          </div>
          </a>
          <div class="alert alert-danger">å°å¿ƒ!ä¾†è·¯ä¸æ˜çš„é€£çµå¯èƒ½ä¸å®‰å…¨!</div>
          <a href="https://cofacts.tw/">å‡è¨Šæ¯æŸ¥è­‰(çœŸçš„å‡çš„-è½‰å‚³æŸ¥è­‰)</a>&nbsp;<a href="https://www.scamadviser.com/check-website/${msg.src}">é€£çµå®‰å…¨æ€§æŸ¥è­‰(scamadviser)</a>

          `+ "</li>")
          window.scrollTo(0, document.body.scrollHeight);
          isConnected = true
          $("#" + msg.id).css("max-width", ($(`.messages[data-room=${MyRoom}]`).css("widih") - 50))
        } else {
          BS_Toast.show({ 'title': msg.to + ' æœ‰æ–°è¨Šæ¯', 'time': 'ç¾åœ¨', 'img': 'bi-chat-left-text-fill' }, { 'html': msg.head })

          $(`.messages[data-room=${msg.to}]`).append("<li>" + `
          ${msg.text}<br>
          <a href='https://${msg.src}' target="_blank" style="text-decoration: none;">
          <div class="input-group mb-3">
            <span class="input-group-text">https://</span>
            <input readonly style="cursor:pointer;" type="text" class="form-control" value='${msg.src}'>
          </div>
          </a>
          <div class="alert alert-danger">å°å¿ƒ!ä¾†è·¯ä¸æ˜çš„é€£çµå¯èƒ½ä¸å®‰å…¨!</div>

          <a href="https://cofacts.tw/">å‡è¨Šæ¯æŸ¥è­‰(çœŸçš„å‡çš„-è½‰å‚³æŸ¥è­‰)</a>&nbsp;<a href="https://www.scamadviser.com/check-website/${msg.src}">é€£çµå®‰å…¨æ€§æŸ¥è­‰(scamadviser)</a>

          `+ "</li>")
          isConnected = true

        }
      }
    });

    socket.on('send txt', function (msg) {

      if (RoomList.includes(msg.to)) {
        if (msg.to == MyRoom) {
          console.log(("https://jerry20201230.github.io/%E6%96%87%E5%AD%97%E7%B7%A8%E8%BC%AF%E5%99%A8/?file-name=" + encodeURIComponent(msg.filename) + "&data=" + encodeURIComponent(msg.src.replace(/\n/g, '<!b>').replace(/\t/g, '<!t>').replace(/ /g, '<!s>'))).length)
          if (("https://jerry20201230.github.io/%E6%96%87%E5%AD%97%E7%B7%A8%E8%BC%AF%E5%99%A8/?file-name=" + encodeURIComponent(msg.filename) + "&data=" + encodeURIComponent(msg.src.replace(/\n/g, '<!b>').replace(/\t/g, '<!t>').replace(/ /g, '<!s>'))).length > 10000) {
            $(`.messages[data-room=${MyRoom}]`).append("<li>" + msg.text.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "<br>æª”æ¡ˆåç¨±:" + msg.filename.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "<p></p><pre class='text'" + "' id='" + msg.id + "'>" + msg.src + "</pre></li>")
          } else {
            $(`.messages[data-room=${MyRoom}]`).append("<li>" + msg.text.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "<br>æª”æ¡ˆåç¨±:" + msg.filename.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "<p></p><pre class='text'" + "' id='" + msg.id + "'>" + msg.src + "</pre><br>åœ¨<a target='_blank' href='https://jerry20201230.github.io/%E6%96%87%E5%AD%97%E7%B7%A8%E8%BC%AF%E5%99%A8/?file-name=" + encodeURIComponent(msg.filename) + "&data=" + encodeURIComponent(msg.src.replace(/\n/g, '<!b>').replace(/\t/g, '<!t>').replace(/ /g, '<!s>')) + "'>æ–‡å­—ç·¨è¼¯å™¨</a>ä¸­ç·¨è¼¯</li>")

          }
          isConnected = true
          $("#" + msg.id).css("max-width", (($(".messages").css("widih") - 50)))
          window.scrollTo(0, document.body.scrollHeight);
        } else {
          BS_Toast.show({ 'title': msg.to + ' æœ‰æ–°è¨Šæ¯', 'time': 'ç¾åœ¨', 'img': 'bi-chat-left-text-fill' }, { 'html': msg.head })

          console.log(("https://jerry20201230.github.io/%E6%96%87%E5%AD%97%E7%B7%A8%E8%BC%AF%E5%99%A8/?file-name=" + encodeURIComponent(msg.filename) + "&data=" + encodeURIComponent(msg.src.replace(/\n/g, '<!b>').replace(/\t/g, '<!t>').replace(/ /g, '<!s>'))).length)
          if (("https://jerry20201230.github.io/%E6%96%87%E5%AD%97%E7%B7%A8%E8%BC%AF%E5%99%A8/?file-name=" + encodeURIComponent(msg.filename) + "&data=" + encodeURIComponent(msg.src.replace(/\n/g, '<!b>').replace(/\t/g, '<!t>').replace(/ /g, '<!s>'))).length > 10000) {
            $(`.messages[data-room=${msg.to}]`).append("<li>" + msg.text.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "<br>æª”æ¡ˆåç¨±:" + msg.filename.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "<p></p><pre class='text'" + "' id='" + msg.id + "'>" + msg.src + "</pre></li>")
          } else {
            $(`.messages[data-room=${msg.to}]`).append("<li>" + msg.text.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "<br>æª”æ¡ˆåç¨±:" + msg.filename.replace(/</g, "&lt;").replace(/>/g, "&gt;") + "<p></p><pre class='text'" + "' id='" + msg.id + "'>" + msg.src + "</pre><br>åœ¨<a target='_blank' href='https://jerry20201230.github.io/%E6%96%87%E5%AD%97%E7%B7%A8%E8%BC%AF%E5%99%A8/?file-name=" + encodeURIComponent(msg.filename) + "&data=" + encodeURIComponent(msg.src.replace(/\n/g, '<!b>').replace(/\t/g, '<!t>').replace(/ /g, '<!s>')) + "'>æ–‡å­—ç·¨è¼¯å™¨</a>ä¸­ç·¨è¼¯</li>")

          }
          isConnected = true
          $("#" + msg.id).css("max-width", (($(".messages").css("widih") - 50)))
        }
      }
    });

    socket.on('send event', function (msg) {

      if (RoomList.includes(msg.to)) {
        if (msg.to == MyRoom) {

          $(`.messages[data-room=${MyRoom}]`).append(
            `<li>
                ${msg.text}<br>
              <div class="card">
                <div class="card-header">æ™‚é–“:&nbsp;${msg.event_start_time.replace(/</g, "&lt;").replace(/>/g, "&gt;")}~${msg.event_end_time.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</div>
                <div class="card-body">
                  <h5 class="card-title">${msg.event_title.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</h5>
                  <p class="card-text">${msg.event_text.replace(/</g, "&lt;").replace(/>/g, "&gt;")}</p>
              
                </div>
              </div>
                
              </li>`)

          isConnected = true
          $("#" + msg.id).css("max-width", (($(".messages").css("widih") - 50)))
          window.scrollTo(0, document.body.scrollHeight);
        } else {
          BS_Toast.show({ 'title': msg.to + ' æœ‰æ–°è¨Šæ¯', 'time': 'ç¾åœ¨', 'img': 'bi-chat-left-text-fill' }, { 'html': msg.head })


          isConnected = true
          $("#" + msg.id).css("max-width", (($(".messages").css("widih") - 50)))
        }
      }



    })


    socket.on('sys-info chat message', function (msg) {

      if (msg.to == "you") {
        $(`.messages[data-room=${RoomList.indexOf(MyRoom)}]`).append("<li class='info'>" + msg.msg + "</li>")
        window.scrollTo(0, document.body.scrollHeight);
        isConnected = true
      } else
        if (RoomList.includes(msg.to)) {
          if (msg.to == MyRoom || msg.to == localStorage.getItem("MyID")) {

            $(`.messages[data-room=${MyRoom}]`).append("<li class='info'>" + msg.msg + "</li>")
            window.scrollTo(0, document.body.scrollHeight);
            isConnected = true

          } else {
            $(`.messages[data-room=${RoomList.indexOf(msg.to)}]`).append("<li class='info'>" + msg.msg + "</li>")

            let icon = "bi-bell-fill"
            if (msg.type == "join") {
              icon = "bi-person-plus-fill"
              BS_Toast.show({ 'img': icon, 'title': msg.head }, { 'html': msg.head })
            } else
              if (msg.type == "leave") {
                icon = "bi-person-x-fill"
                BS_Toast.show({ 'img': icon, 'title': msg.head }, { 'html': msg.msg })
              } else {
                BS_Toast.show({ 'img': icon, 'title': msg.head }, { 'html': msg.msg })
              }



          }
        }


    });

    socket.on('sys-warn chat message', function (msg) {

      $(`.messages[data-room=${MyRoom}]`).append("<li class='warn'>" + msg + "</li>")


      window.scrollTo(0, document.body.scrollHeight);
      isConnected = true


    });
    /*socket.on('nickname', function (msg) {
      document.getElementById("NMinput").setAttribute("value", msg)
      var item = document.createElement('li');
      item.textContent = "ç³»çµ±è‡ªå‹•ç”Ÿæˆæš±ç¨±: " + msg;
      messages.appendChild(item);
      item.setAttribute("class", "info")
      window.scrollTo(0, document.body.scrollHeight);
      isConnected = true
      my_nickname = msg


    });*/
    socket.on("BAN", function (msg) {

      $(`.messages[data-room=${MyRoom}]`).append("<li>ä½ çš„é€£æ¥å·²è¢«ä¼ºæœå™¨ä¸­æ–· [åŸå› ] å¤§é‡ç™¼é€ç›¸åŒè¨Šæ¯/æ´—ç‰ˆ</li>")
      window.scrollTo(0, document.body.scrollHeight);
      socket.disconnect()
    })

    socket.on('people online', function (msg) {
      if (msg.for == MyRoom) {
        $(".onlinePeople").html(msg)
        isConnected = true
      }
    });
    socket.on('typeing', function (msg) {
      /*if(msg.to == MyRoom){
      if (msg.msg == " æ­£åœ¨è¼¸å…¥...") {
        $("#isTypeing").html("")
      } else {
        $("#isTypeing").html(msg.msg)
      }
    }*/
      console.log(msg)

    });
    socket.on('typeing-end', function (msg) {
      /*if(msg.to == MyRoom){
      if (msg.msg == " æ­£åœ¨è¼¸å…¥...") {
        $("#isTypeing").html("")
      } else {
        $("#isTypeing").html(msg.msg)
      }
    }*/
      console.log(msg)
    });


    socket.on("connect", () => {
      isConnected = true
      console.log(socket.id);
      console.log("connected")
      $("#statue_select").val("statue_Green:online")
      $("#statue_select").attr("disabled", false)
      $("#statue-circle").attr("class", "position-absolute top-0 start-100 translate-middle p-2 bg-success border border-light rounded-circle")

      $(".messages").append("<li class='success'>è£ç½®å·²é€£æ¥åˆ°ä¼ºæœå™¨</li>")
      BS_Toast.show({ "title": "å·²é€£ç·šåˆ°ä¼ºæœå™¨", "img": "bi-cloud-fill" }, { "html": "è£ç½®å·²é€£æ¥åˆ°ä¼ºæœå™¨" })
      window.scrollTo(0, document.body.scrollHeight);

      document.getElementById("connectStatue").innerHTML = "å·²é€£ç·š"
      document.getElementById("connectStatue").style.color = "#39ef2f"
      document.getElementById("isTypeing").innerHTML = " "


    });



    socket.on("disconnect", () => {
      isConnected = false
      $("#statue_select").val("statue_White:disconnect")
      $("#statue_select").attr("disabled", true)
      $("#statue-circle").attr("class", "position-absolute top-0 start-100 translate-middle p-2 bg-light border border-light rounded-circle")
      console.log("disconnected")
      BS_Toast.show({ "title": "æœªé€£ç·šåˆ°ä¼ºæœå™¨", "img": "bi-cloud-slash-fill" }, { "html": "è£ç½®æœªé€£æ¥åˆ°ä¼ºæœå™¨,æ­£åœ¨å˜—è©¦é€£æ¥..." })


      $(".messages").append("<li class='warn'>è£ç½®æœªé€£æ¥åˆ°ä¼ºæœå™¨,æ­£åœ¨å˜—è©¦é€£æ¥...</li>")

      window.scrollTo(0, document.body.scrollHeight);
      document.getElementById("connectStatue").innerHTML = "æœªé€£ç·š / å·²æ–·ç·š"
      document.getElementById("connectStatue").style.color = "#ce3434"
      document.getElementById("isTypeing").innerHTML = "è£ç½®æœªé€£æ¥åˆ°ä¼ºæœå™¨ï¼Œç„¡æ³•å‚³é€è¨Šæ¯"
    });


    //==============contextmenu==============//

    /*  
    <div id="contextmenu" style="display: none;">
      <div id="content-tool"></div>
      <ul id="contextmenu-ul">
 
      </ul>
    </div>*/
    window.oncontextmenu = function (e) {
      contextmenu.x = e.clientX;
      contextmenu.y = e.clientY;
      e.preventDefault()
    }
    var contextmenu = {
      menu: $("#contxtmenu"),
      x: 0,
      y: 0,
      set: function (count, text, callback) {

        for (let i = 0; i < count; i++) {

          $("#contextmenu-ul").append("<li onclick='" + callback[i] + "'>" + text[i] + "</li>")
        }
      },
      show: function (callback) {

        //é¸å–®å‡ºç¾å¾Œçš„ä½ç½®
        contextmenu.menu.css("display", "block")
        contextmenu.menu.css("left", contextmenu.x + 'px')
        contextmenu.menu.css("top", contextmenu.y + 'px')

        $("#contxtmenu").show()
      }
    }


    //==============Toast notification============//
    /*  <div id="toast">
    
    </div>*/

    /*<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11" id=toast>
  <div id="liveToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
    <div class="toast-header">
      <img src="..." class="rounded me-2" alt="...">
      <strong class="me-auto">Bootstrap</strong>
      <small>11 mins ago</small>
      <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
    </div>
    <div class="toast-body">
      Hello, world! This is a toast message.
    </div>
  </div>
</div>*/


    //header,footer:obj
    /*
    Like:
  
    header={
    title:'@group-01',
    time:'ç¾åœ¨',
    img:'group.svg'
  }
  body={
    html:`Bob send a file...`
  }
  
  
    
    */






    var BS_Toast = {
      toast_id: 0,
      show: function (header, body) {
        $("#toast").append(` 
            <div id='BS-Toast-${BS_Toast.toast_id}' class="toast" role="alert" aria-live="assertive" aria-atomic="true">
              <div class="toast-header" >
                <i class='bi ${header.img}'></i>&nbsp;
                <strong class="me-auto">${header.title}</strong>
                <small>${hour}:${mins}</small>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
             </div>
            <div class="toast-body">${body.html}</div>
            </div>`)

        let Thistoast = new bootstrap.Toast(document.getElementById(`BS-Toast-${BS_Toast.toast_id}`))

        Thistoast.show()

        BS_Toast.toast_id += 1
      }
    }


    //width setting

    $(".bottom").css("width", $(".tab-content").css("width"))
    $("#v-pills-tab").css("top", $(".navbar-dark").css("height"))

    window.onresize = function () {
      $(".bottom").css("width", $(".tab-content").css("width"))
      $("#v-pills-tab").css("top", $(".navbar-dark").css("height"))
      if (window.innerWidth < 936) {
        $("#v-pills-tab").css("max-height", $("#navbarToggleExternalContent").css("height"))
        $("#v-pills-tab").appendTo($("#chat-tabs"));

      }

    }



    //onblur => notifications.show() .etc
    window.onblur = function () { notifications = true }

    window.onfocus = function () { notifications = false }


    //width => tabs display

    if (window.innerWidth < 936) {
      $("#v-pills-tab").appendTo($("#chat-tabs"));
      $("#v-pills-tab").css("max-height", $("#navbarToggleExternalContent").css("height"))

    }


    if ($.UrlParam("create") == 'true' && $.UrlParam("join") !== 'true') {
      $("#dl-file-2").attr("checked", true)
      $("#dl-file-1").attr("checked", false)
      $("#joinRoom").hide();
      $("#createRoom").show();
    } else
      if ($.UrlParam("join") == 'true' && $.UrlParam("create") !== 'true') {
        $("#dl-file-2").attr("checked", false)
        $("#dl-file-1").attr("checked", true)
        $("#joinRoom").show();
        $("#createRoom").hide();
      } else
        if ($.UrlParam("create") == 'true' && $.UrlParam("join") == 'true') {
          $("body").html("<h2>: ( ç³»çµ±ç™¼ç”ŸéŒ¯èª¤!</h2><p>è«‹å‰å¾€<a href='https://jerry20200815.herokuapp.com'>ä¸»é </a>ä¸¦é‡è©¦</p>")
        }

    if ($.UrlParam("mobile") == "true" && window.mobileAndTabletCheck()) {
      $("body").html("<h2>æš«æ™‚ä¸æ”¯æ´è¡Œå‹•è£ç½®</h2><p>è«‹ä½¿ç”¨æ¡Œä¸Šå‹é›»è…¦é–‹å•Ÿæ­¤ç¶²ç«™</p>")
      alert("æš«æ™‚ä¸æ”¯æ´è¡Œå‹•è£ç½®ï¼Œè«‹ä½¿ç”¨æ¡Œä¸Šå‹é›»è…¦é–‹å•Ÿæ­¤ç¶²ç«™")
    }


  </script>
</body>

</html>